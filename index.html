<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>财富博弈模拟器 - 移动优化版</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --success: #52c41a;
            --danger: #ff4d4f;
            --warning: #faad14;
        }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            margin: 0; padding: 10px; background: #f0f2f5; color: #333;
        }
        .container { 
            max-width: 100%; margin: auto; background: white; 
            padding: 15px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); 
        }
        h2 { font-size: 1.25rem; margin-top: 0; text-align: center; }
        .rule-desc { font-size: 0.85rem; color: #666; text-align: center; margin-bottom: 15px; }
        
        /* 统计卡片适配手机 */
        .stats { 
            display: grid; grid-template-columns: 1fr; gap: 8px; margin-bottom: 15px; 
        }
        @media (min-width: 480px) { .stats { grid-template-columns: repeat(3, 1fr); } }
        
        .stat-card { 
            padding: 12px; border-radius: 8px; text-align: center; color: white; 
            font-size: 0.9rem; position: relative; overflow: hidden;
        }
        .card-a { background: var(--danger); }
        .card-b { background: var(--success); }
        .card-c { background: var(--primary); }
        .val { font-size: 1.1rem; display: block; margin-top: 4px; font-weight: bold; overflow-x: auto; }

        /* 按钮区域 */
        .controls { 
            display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 15px; 
        }
        button { 
            padding: 14px 10px; cursor: pointer; border: none; border-radius: 8px; 
            color: white; font-weight: bold; font-size: 0.95rem; active { opacity: 0.7; }
        }
        .btn-manual { background: var(--primary); grid-column: span 2; }
        .btn-auto { background: #722ed1; }
        .btn-stop { background: var(--warning); }
        .btn-reset { background: #666; }
        
        .round-info { 
            text-align: center; font-size: 0.9rem; font-weight: bold; grid-column: span 2;
            padding: 5px; color: #444;
        }

        /* 图表容器 */
        .chart-container { position: relative; height: 300px; width: 100%; }
    </style>
</head>
<body>
<div class="container">
    <h2>无限按钮模拟器</h2>
    <p class="rule-desc">50% 概率本金*9，50% 概率本介*0.1</p>
    
    <div class="stats">
        <div class="stat-card card-a">100% 投入<span class="val" id="valA">10,000</span></div>
        <div class="stat-card card-b">44% 凯利<span class="val" id="valB">10,000</span></div>
        <div class="stat-card card-c">20% 稳健<span class="val" id="valC">10,000</span></div>
    </div>

    <div class="controls">
        <button class="btn-manual" onclick="pressButton()">按一下按钮</button>
        <button id="autoBtn" class="btn-auto" onclick="toggleAuto()">开始自动</button>
        <button class="btn-reset" onclick="reset()">重置</button>
        <div id="roundText" class="round-info">点击次数：0</div>
    </div>

    <div class="chart-container">
        <canvas id="wealthChart"></canvas>
    </div>
</div>

<script>
let round = 0;
let dataA = [10000], dataB = [10000], dataC = [10000], labels = [0];
let autoInterval = null;

function pressButton() {
    round++;
    const win = Math.random() < 0.5;
    const factor = win ? 9 : 0.1;
    
    let lastA = dataA[dataA.length - 1];
    dataA.push(lastA > 0.1 ? lastA * factor : 0);

    let lastB = dataB[dataB.length - 1];
    let investB = lastB * 0.44;
    dataB.push((lastB - investB) + (investB * factor));

    let lastC = dataC[dataC.length - 1];
    let investC = lastC * 0.20;
    dataC.push((lastC - investC) + (investC * factor));

    labels.push(round);
    updateUI();
}

function updateUI() {
    document.getElementById('valA').innerText = Math.floor(dataA[dataA.length-1]).toLocaleString();
    document.getElementById('valB').innerText = Math.floor(dataB[dataB.length-1]).toLocaleString();
    document.getElementById('valC').innerText = Math.floor(dataC[dataC.length-1]).toLocaleString();
    document.getElementById('roundText').innerText = `点击次数：${round}`;
    
    const maxPoints = 30; // 手机端显示更少的点，保证清晰
    chart.data.labels = labels.slice(-maxPoints);
    chart.data.datasets[0].data = dataA.slice(-maxPoints);
    chart.data.datasets[1].data = dataB.slice(-maxPoints);
    chart.data.datasets[2].data = dataC.slice(-maxPoints);
    
    chart.update('none');
}

function toggleAuto() {
    const btn = document.getElementById('autoBtn');
    if (autoInterval) {
        clearInterval(autoInterval);
        autoInterval = null;
        btn.innerText = "开始自动";
        btn.className = "btn-auto";
    } else {
        autoInterval = setInterval(pressButton, 300); // 稍微调慢一点点，手机渲染更稳
        btn.innerText = "停止自动";
        btn.className = "btn-stop";
    }
}

function reset() {
    if (autoInterval) toggleAuto();
    round = 0;
    dataA = [10000]; dataB = [10000]; dataC = [10000]; labels = [0];
    updateUI();
}

const ctx = document.getElementById('wealthChart').getContext('2d');
const chart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: labels,
        datasets: [
            { label: '100%', data: dataA, borderColor: '#ff4d4f', borderWidth: 2, pointRadius: 0 },
            { label: '44%', data: dataB, borderColor: '#52c41a', borderWidth: 2, pointRadius: 0 },
            { label: '20%', data: dataC, borderColor: '#1890ff', borderWidth: 2, pointRadius: 0 }
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: { 
            y: { 
                type: 'logarithmic', 
                ticks: { 
                    maxRotation: 0,
                    callback: function(value) {
                        if (value >= 1e9) return (value/1e9).toFixed(1) + 'B';
                        if (value >= 1e6) return (value/1e6).toFixed(1) + 'M';
                        if (value >= 1e3) return (value/1e3).toFixed(1) + 'K';
                        return value;
                    }
                }
            } 
        },
        plugins: { legend: { display: true, position: 'bottom', labels: { boxWidth: 12 } } },
        animation: false
    }
});
</script>
</body>
</html>
